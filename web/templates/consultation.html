{% extends "base.html" %}

{% block title %}ì˜ë£Œ ìƒë‹´ - AI Medical A2A{% endblock %}

{% block extra_head %}
<style>
    .consultation-progress {
        display: none;
        margin-top: 30px;
        background: var(--card-bg);
        border-radius: 16px;
        padding: 24px;
        border: 1px solid var(--border-color);
    }
    
    .progress-step {
        margin: 16px 0;
        padding: 20px;
        border-left: 4px solid var(--accent-blue);
        background: rgba(255, 255, 255, 0.02);
        border-radius: 12px;
        transition: all 0.3s ease;
    }
    
    .progress-step.active {
        border-left-color: var(--success-color);
        background: rgba(76, 175, 80, 0.1);
        animation: pulse 2s infinite;
    }
    
    .progress-step.error {
        border-left-color: var(--error-color);
        background: rgba(244, 67, 54, 0.1);
    }
    
    .agent-status {
        display: inline-block;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        margin-right: 12px;
        transition: all 0.3s ease;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
    }
    
    .agent-status.waiting { 
        background-color: #6c757d;
        animation: none;
    }
    .agent-status.processing { 
        background-color: var(--warning-color);
        animation: pulse 1.5s infinite;
        box-shadow: 0 0 12px var(--warning-color);
    }
    .agent-status.completed { 
        background-color: var(--success-color);
        box-shadow: 0 0 12px var(--success-color);
    }
    .agent-status.error { 
        background-color: var(--error-color);
        box-shadow: 0 0 12px var(--error-color);
    }
    
    .agent-reasoning-container {
        margin-top: 16px;
        padding: 0;
    }
    
    .reasoning-toggle {
        background: rgba(57, 73, 171, 0.2);
        border: 1px solid var(--accent-blue);
        color: var(--text-light);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-left: 28px;
    }
    
    .reasoning-toggle:hover {
        background: rgba(57, 73, 171, 0.4);
        transform: translateY(-1px);
    }
    
    .agent-reasoning {
        background: rgba(26, 35, 126, 0.1);
        border: 1px solid var(--accent-blue);
        border-radius: 8px;
        padding: 16px;
        margin: 12px 0 0 28px;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.85rem;
        color: var(--text-muted);
        max-height: 250px;
        overflow-y: auto;
        display: none;
        position: relative;
    }
    
    .agent-reasoning.show {
        display: block;
        animation: slideDown 0.4s ease;
    }
    
    .reasoning-line {
        margin: 6px 0;
        padding: 6px 10px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 4px;
        border-left: 2px solid transparent;
        transition: all 0.3s ease;
    }
    
    .reasoning-line.thinking {
        border-left-color: var(--warning-color);
        animation: typewriter 0.5s ease;
        background: rgba(255, 152, 0, 0.1);
    }
    
    .reasoning-line.analyzing {
        border-left-color: var(--accent-blue);
        background: rgba(57, 73, 171, 0.1);
    }
    
    .reasoning-line.completed {
        border-left-color: var(--success-color);
        background: rgba(76, 175, 80, 0.1);
    }
    
    .reasoning-timestamp {
        color: var(--text-muted);
        font-size: 0.75rem;
        opacity: 0.7;
    }
    
    .thinking-indicator {
        display: inline-block;
        margin-left: 8px;
    }
    
    .thinking-dots::after {
        content: '.';
        animation: dots 1.5s steps(3, end) infinite;
    }
    
    @keyframes dots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60%, 100% { content: '...'; }
    }
    
    @keyframes typewriter {
        from {
            opacity: 0;
            transform: translateX(-10px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <h1 class="text-center mb-4">
            <i class="fas fa-comments text-primary"></i> ì˜ë£Œ ìƒë‹´
        </h1>
        
        {% if error %}
        <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle"></i> {{ error }}
        </div>
        {% endif %}
        
        <div class="question-form">
            <form id="consultationForm" method="POST" action="{{ url_for('consultation') }}">
                <div class="mb-3">
                    <label for="question" class="form-label">
                        <i class="fas fa-question-circle"></i> ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”
                    </label>
                    <textarea 
                        class="form-control" 
                        id="question" 
                        name="question" 
                        rows="5" 
                        placeholder="ì˜ˆ: ì†Œë³€ì— í”¼ê°€ ë³´ì´ê³  ìì£¼ ì†Œë³€ì„ ë´…ë‹ˆë‹¤. ì–´ë–¤ ê²€ì‚¬ë¥¼ ë°›ì•„ì•¼ í•˜ë‚˜ìš”?"
                        required></textarea>
                    <div class="form-text">
                        ë°©ê´‘ ë° ì „ë¦½ì„  ê´€ë ¨ ì§ˆë¬¸ì„ ìì„¸íˆ ì…ë ¥í•´ì£¼ì„¸ìš”. 
                        ë‘ ì „ë¬¸ AI ì—ì´ì „íŠ¸ê°€ í˜‘ë ¥í•˜ì—¬ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> ìƒë‹´ ìš”ì²­
                    </button>
                </div>
            </form>
        </div>
        
        <!-- ì§„í–‰ ìƒí™© í‘œì‹œ -->
        <div id="consultationProgress" class="consultation-progress">
            <h3><i class="fas fa-tasks"></i> ìƒë‹´ ì§„í–‰ ìƒí™©</h3>
            
            <div id="progressSteps">
                <div class="progress-step" id="step-start">
                    <span class="agent-status waiting" id="status-start"></span>
                    <strong>ìƒë‹´ ì‹œì‘</strong> - ì§ˆë¬¸ì„ ì ‘ìˆ˜í–ˆìŠµë‹ˆë‹¤
                </div>
                
                <div class="progress-step" id="step-bladder">
                    <span class="agent-status waiting" id="status-bladder"></span>
                    <strong>DR_BLADDER</strong> - ë°©ê´‘ ì „ë¬¸ê°€ê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤
                    <div class="agent-reasoning-container">
                        <button class="reasoning-toggle" onclick="toggleReasoning('bladder')" id="toggle-bladder" style="display: none;">
                            <i class="fas fa-brain"></i> ì¶”ë¡  ê³¼ì • ë³´ê¸°
                        </button>
                        <div class="agent-reasoning" id="reasoning-bladder"></div>
                    </div>
                </div>
                
                <div class="progress-step" id="step-prostate">
                    <span class="agent-status waiting" id="status-prostate"></span>
                    <strong>DR_PROSTATE</strong> - ì „ë¦½ì„  ì „ë¬¸ê°€ê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤
                    <div class="agent-reasoning-container">
                        <button class="reasoning-toggle" onclick="toggleReasoning('prostate')" id="toggle-prostate" style="display: none;">
                            <i class="fas fa-brain"></i> ì¶”ë¡  ê³¼ì • ë³´ê¸°
                        </button>
                        <div class="agent-reasoning" id="reasoning-prostate"></div>
                    </div>
                </div>
                
                <div class="progress-step" id="step-synthesis">
                    <span class="agent-status waiting" id="status-synthesis"></span>
                    <strong>ì˜ê²¬ ì¢…í•©</strong> - ì „ë¬¸ê°€ ì˜ê²¬ì„ í†µí•©í•˜ê³  ìˆìŠµë‹ˆë‹¤
                    <div class="agent-reasoning-container">
                        <button class="reasoning-toggle" onclick="toggleReasoning('synthesis')" id="toggle-synthesis" style="display: none;">
                            <i class="fas fa-brain"></i> ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì¶”ë¡  ê³¼ì • ë³´ê¸°
                        </button>
                        <div class="agent-reasoning" id="reasoning-synthesis"></div>
                    </div>
                </div>
                
                <div class="progress-step" id="step-complete">
                    <span class="agent-status waiting" id="status-complete"></span>
                    <strong>ìƒë‹´ ì™„ë£Œ</strong> - ì¢…í•© ê²°ê³¼ë¥¼ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤
                </div>
            </div>
        </div>
        
        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ìƒë‹´ ì¤‘...</span>
            </div>
            <p class="mt-2">ì „ë¬¸ AI ì—ì´ì „íŠ¸ë“¤ì´ ìƒë‹´ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-12">
        <div class="alert alert-info" role="alert">
            <h5><i class="fas fa-info-circle"></i> ìƒë‹´ ì§„í–‰ ê³¼ì •</h5>
            <ol>
                <li><strong>ì§ˆë¬¸ ì ‘ìˆ˜:</strong> ì…ë ¥í•˜ì‹  ì§ˆë¬¸ì„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°ê°€ ì ‘ìˆ˜í•©ë‹ˆë‹¤</li>
                <li><strong>ì „ë¬¸ê°€ ë¶„ì„:</strong> DR_BLADDERì™€ DR_PROSTATEê°€ ë™ì‹œì— ì§ˆë¬¸ì„ ë¶„ì„í•©ë‹ˆë‹¤</li>
                <li><strong>ì˜ê²¬ ì¢…í•©:</strong> ë‘ ì „ë¬¸ê°€ì˜ ì˜ê²¬ì„ í†µí•©í•˜ì—¬ ì¢…í•©ì ì¸ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤</li>
                <li><strong>ê²°ê³¼ ì œê³µ:</strong> ê° ì „ë¬¸ê°€ì˜ ê°œë³„ ì˜ê²¬ê³¼ ì¢…í•© ì˜ê²¬ì„ í•¨ê»˜ ì œê³µí•©ë‹ˆë‹¤</li>
            </ol>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="alert alert-warning" role="alert">
            <h5><i class="fas fa-exclamation-triangle"></i> ì˜í•™ì  ë©´ì±…ì¡°í•­</h5>
            <p class="mb-0">
                ì´ AI ìƒë‹´ ê²°ê³¼ëŠ” ì°¸ê³ ìš© ì •ë³´ì…ë‹ˆë‹¤. ì‹¤ì œ ì˜ë£Œ ì§„ë‹¨ì´ë‚˜ ì¹˜ë£Œê°€ í•„ìš”í•œ ê²½ìš° 
                ë°˜ë“œì‹œ ì „ë¬¸ ì˜ë£Œì§„ê³¼ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('consultationForm');
    const submitBtn = document.getElementById('submitBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const progressDiv = document.getElementById('consultationProgress');
    
    // AJAXë¥¼ ì‚¬ìš©í•œ ë¹„ë™ê¸° ìƒë‹´ ìš”ì²­
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const question = document.getElementById('question').value.trim();
        if (!question) {
            alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        
        // UI ìƒíƒœ ë³€ê²½
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ìƒë‹´ ìš”ì²­ ì¤‘...';
        loadingSpinner.style.display = 'block';
        progressDiv.style.display = 'block';
        
        // ì§„í–‰ ìƒí™© ì‹œë®¬ë ˆì´ì…˜
        simulateProgress();
        
        // AJAX ìš”ì²­
        fetch('/api/consult', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ question: question })
        })
        .then(response => response.json())
        .then(data => {
            console.log('ğŸ”¥ API ì‘ë‹µ ë°ì´í„°:', data);
            
            if (data.error) {
                throw new Error(data.error);
            }
            
            // POST ë°©ì‹ìœ¼ë¡œ ê²°ê³¼ í˜ì´ì§€ì— ë°ì´í„° ì „ë‹¬
            const resultForm = document.createElement('form');
            resultForm.method = 'POST';
            resultForm.action = '/result';
            
            const resultInput = document.createElement('input');
            resultInput.type = 'hidden';
            resultInput.name = 'consultation_result';
            resultInput.value = JSON.stringify(data);
            resultForm.appendChild(resultInput);
            
            document.body.appendChild(resultForm);
            resultForm.submit();
        })
        .catch(error => {
            console.error('ìƒë‹´ ìš”ì²­ ì‹¤íŒ¨:', error);
            alert('ìƒë‹´ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            
            // UI ë³µì›
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ìƒë‹´ ìš”ì²­';
            loadingSpinner.style.display = 'none';
            progressDiv.style.display = 'none';
        });
    });
    
    function simulateProgress() {
        const steps = [
            { id: 'start', delay: 500 },
            { id: 'bladder', delay: 2000 },
            { id: 'prostate', delay: 2500 },
            { id: 'synthesis', delay: 6000 },
            { id: 'complete', delay: 8000 }
        ];
        
        steps.forEach(step => {
            setTimeout(() => {
                updateProgressStep(step.id, 'processing');
                
                // ì—ì´ì „íŠ¸ë³„ ì¶”ë¡  ê³¼ì • ì‹œë®¬ë ˆì´ì…˜
                if (step.id === 'bladder') {
                    simulateAgentReasoning('bladder');
                } else if (step.id === 'prostate') {
                    simulateAgentReasoning('prostate');
                } else if (step.id === 'synthesis') {
                    simulateOrchestratorReasoning('synthesis');
                }
                
                const completionDelay = (step.id === 'bladder' || step.id === 'prostate') ? 3500 : (step.id === 'synthesis') ? 4000 : 1000;
                setTimeout(() => {
                    updateProgressStep(step.id, 'completed');
                }, completionDelay);
            }, step.delay);
        });
    }
    
    function updateProgressStep(stepId, status) {
        const stepDiv = document.getElementById(`step-${stepId}`);
        const statusIcon = document.getElementById(`status-${stepId}`);
        
        // ìƒíƒœ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        statusIcon.className = `agent-status ${status}`;
        
        // ë‹¨ê³„ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
        if (status === 'completed') {
            stepDiv.classList.add('active');
        } else if (status === 'error') {
            stepDiv.classList.add('error');
        }
        
        // ì¶”ë¡  ê³¼ì • ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
        const toggleBtn = document.getElementById(`toggle-${stepId}`);
        if (toggleBtn && (stepId === 'bladder' || stepId === 'prostate' || stepId === 'synthesis')) {
            if (status === 'processing') {
                toggleBtn.style.display = 'inline-block';
            }
        }
    }
    // ì¶”ë¡  ê³¼ì • í† ê¸€ í•¨ìˆ˜
    window.toggleReasoning = function(agentType) {
        const reasoningDiv = document.getElementById(`reasoning-${agentType}`);
        const toggleBtn = document.getElementById(`toggle-${agentType}`);
        
        if (reasoningDiv.classList.contains('show')) {
            reasoningDiv.classList.remove('show');
            toggleBtn.innerHTML = '<i class="fas fa-brain"></i> ì¶”ë¡  ê³¼ì • ë³´ê¸°';
        } else {
            reasoningDiv.classList.add('show');
            toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i> ì¶”ë¡  ê³¼ì • ìˆ¨ê¹€';
        }
    };
    
    // ì—ì´ì „íŠ¸ ì¶”ë¡  ê³¼ì • ì‹œë®¬ë ˆì´ì…˜
    function simulateAgentReasoning(agentType) {
        const reasoningDiv = document.getElementById(`reasoning-${agentType}`);
        
        let reasoningSteps = [];
        
        if (agentType === 'bladder') {
            reasoningSteps = [
                { text: 'í™˜ì ì¦ìƒ ë¶„ì„ ì‹œì‘...', type: 'thinking', delay: 500 },
                { text: 'EAU ë°©ê´‘ì•” ê°€ì´ë“œë¼ì¸ ê²€ìƒ‰ ì¤‘', type: 'analyzing', delay: 1000 },
                { text: 'ì¦ìƒê³¼ ì§„ë‹¨ ê¸°ì¤€ ë¹„êµ ë¶„ì„', type: 'analyzing', delay: 1500 },
                { text: 'ì°¸ê³  ë¬¸í—Œ ë° ì—°ê´€ ì§€ì‹ ê²€ìƒ‰', type: 'thinking', delay: 2000 },
                { text: 'ìœ„í—˜ ìš”ì¸ í‰ê°€ ë° ë¶„ë¥˜', type: 'analyzing', delay: 2500 },
                { text: 'ì¹˜ë£Œ ì˜µì…˜ ë° ê¶Œê³ ì‚¬í•­ ì •ë¦¬', type: 'thinking', delay: 3000 },
                { text: 'ìµœì¢… ì˜ê²¬ ì¢…í•© ì™„ë£Œ', type: 'completed', delay: 3500 }
            ];
        } else if (agentType === 'prostate') {
            reasoningSteps = [
                { text: 'ì „ë¦½ì„  ê´€ë ¨ ì¦ìƒ ë¶„ì„ ì‹œì‘...', type: 'thinking', delay: 500 },
                { text: 'EAU ì „ë¦½ì„ ì•” ê°€ì´ë“œë¼ì¸ ì°¸ì¡°', type: 'analyzing', delay: 1000 },
                { text: 'PSA ìˆ˜ì¹˜ ë° ìœ„í—˜ ì¸ì í‰ê°€', type: 'analyzing', delay: 1500 },
                { text: 'ì—°ë ¹ë³„ ìŠ¤í¬ë¦¬ë‹ ê¸°ì¤€ ê²€í† ', type: 'thinking', delay: 2000 },
                { text: 'ì§„ë‹¨ ë° ë³‘ê¸° ê²°ì • ë¶„ì„', type: 'analyzing', delay: 2500 },
                { text: 'ì¹˜ë£Œ ì˜µì…˜ ë° ì˜ˆí›„ í‰ê°€', type: 'thinking', delay: 3000 },
                { text: 'ì „ë¬¸ê°€ ì˜ê²¬ ì •ë¦¬ ì™„ë£Œ', type: 'completed', delay: 3500 }
            ];
        }
        
        reasoningSteps.forEach(step => {
            setTimeout(() => {
                addReasoningLine(agentType, step.text, step.type);
            }, step.delay);
        });
    }
    
    function addReasoningLine(agentType, text, type) {
        const reasoningDiv = document.getElementById(`reasoning-${agentType}`);
        const timestamp = new Date().toLocaleTimeString('ko-KR', { 
            hour12: false, 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit' 
        });
        
        const line = document.createElement('div');
        line.className = `reasoning-line ${type}`;
        
        let icon = '';
        switch(type) {
            case 'thinking':
                icon = '<i class="fas fa-lightbulb"></i>';
                break;
            case 'analyzing':
                icon = '<i class="fas fa-search"></i>';
                break;
            case 'completed':
                icon = '<i class="fas fa-check-circle"></i>';
                break;
        }
        
        line.innerHTML = `
            <span class="reasoning-timestamp">[${timestamp}]</span> 
            ${icon} ${text}
            ${type === 'thinking' ? '<span class="thinking-indicator"><span class="thinking-dots"></span></span>' : ''}
        `;
        
        reasoningDiv.appendChild(line);
        reasoningDiv.scrollTop = reasoningDiv.scrollHeight;
    }
    
    // ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ì¶”ë¡  ê³¼ì • ì‹œë®¬ë ˆì´ì…˜
    function simulateOrchestratorReasoning(orchestratorType) {
        const reasoningDiv = document.getElementById(`reasoning-${orchestratorType}`);
        
        const reasoningSteps = [
            { text: 'ë‘ ì „ë¬¸ê°€ ì˜ê²¬ ìˆ˜ì§‘ ì™„ë£Œ...', type: 'analyzing', delay: 500 },
            { text: 'DR_BLADDER ì˜ê²¬ ë¶„ì„: ë°©ê´‘ ë° ë¹„ë‡¨ê¸°ê³¼ ê´€ì  íŒŒì•…', type: 'thinking', delay: 1000 },
            { text: 'DR_PROSTATE ì˜ê²¬ ë¶„ì„: ì „ë¦½ì„  ì „ë¬¸ ê´€ì  íŒŒì•…', type: 'thinking', delay: 1500 },
            { text: 'ë‘ ì˜ê²¬ ê°„ ê³µí†µì  ë° ì°¨ì´ì  ë¹„êµ ë¶„ì„', type: 'analyzing', delay: 2000 },
            { text: 'ìƒí˜¸ ë³´ì™„ì  ì •ë³´ í™•ì¸ ë° ì¤‘ë³µ ë‚´ìš© ì œê±°', type: 'thinking', delay: 2500 },
            { text: 'í™˜ì ë§¥ë½ì— ë§ëŠ” ì¢…í•© ìš°ì„ ìˆœìœ„ ê²°ì •', type: 'analyzing', delay: 3000 },
            { text: 'EAU ê°€ì´ë“œë¼ì¸ ê¸°ë°˜ ìµœì¢… ê¶Œê³ ì‚¬í•­ ì •ë¦¬', type: 'thinking', delay: 3500 },
            { text: 'ì¢…í•© ì˜ë£Œ ìƒë‹´ ê²°ê³¼ ìƒì„± ì™„ë£Œ', type: 'completed', delay: 4000 }
        ];
        
        reasoningSteps.forEach(step => {
            setTimeout(() => {
                addOrchestratorReasoningLine(orchestratorType, step.text, step.type);
            }, step.delay);
        });
    }
    
    function addOrchestratorReasoningLine(orchestratorType, text, type) {
        const reasoningDiv = document.getElementById(`reasoning-${orchestratorType}`);
        const timestamp = new Date().toLocaleTimeString('ko-KR', { 
            hour12: false, 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit' 
        });
        
        const line = document.createElement('div');
        line.className = `reasoning-line ${type}`;
        
        let icon = '';
        switch(type) {
            case 'thinking':
                icon = '<i class="fas fa-brain"></i>';
                break;
            case 'analyzing':
                icon = '<i class="fas fa-search-plus"></i>';
                break;
            case 'completed':
                icon = '<i class="fas fa-check-double"></i>';
                break;
        }
        
        line.innerHTML = `
            <span class="reasoning-timestamp">[${timestamp}]</span> 
            ${icon} ${text}
            ${type === 'thinking' ? '<span class="thinking-indicator"><span class="thinking-dots"></span></span>' : ''}
        `;
        
        reasoningDiv.appendChild(line);
        reasoningDiv.scrollTop = reasoningDiv.scrollHeight;
    }
    
});

// ê²°ê³¼ í˜ì´ì§€ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¼ìš°íŠ¸ ì¶”ê°€ í•„ìš”
</script>
{% endblock %}